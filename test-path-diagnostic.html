<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Diagn√≥stico de Rutas - iOS Safari</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .diagnostic-section {
            padding: 30px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .test-title {
            color: #2c3e50;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e74c3c;
        }
        
        .video-test {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        
        .path-info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            border: 1px solid #bee5eb;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .status.loading { background: #fff3cd; color: #856404; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #e2e3e5; color: #383d41; }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #e74c3c;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }
        
        .results-panel {
            background: #2c3e50;
            color: white;
            padding: 30px;
        }
        
        .results-panel h3 {
            margin-bottom: 20px;
            color: #ecf0f1;
        }
        
        .result-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; }
            .diagnostic-section { padding: 20px; }
            .controls { flex-direction: column; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Diagn√≥stico de Rutas de Video</h1>
            <p>Detecta qu√© ruta funciona en tu dispositivo iOS Safari</p>
            <div id="deviceInfo" style="margin-top: 15px; font-size: 0.9rem;"></div>
        </div>
        
        <!-- TEST 1: Ruta Relativa Simple -->
        <div class="diagnostic-section">
            <h2 class="test-title">üìÅ Test 1: Ruta Relativa Simple</h2>
            <div class="video-test">
                <div class="path-info">
                    <strong>Ruta:</strong> assets/videos/Caja/arqueo-caja/arqueo-caja.mp4
                </div>
                <div class="video-container">
                    <video id="video1" controls playsinline webkit-playsinline muted preload="metadata">
                        <source src="assets/videos/Caja/arqueo-caja/arqueo-caja.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="controls">
                    <button class="btn" onclick="testVideo(1, 'load')">üîÑ Cargar</button>
                    <button class="btn" onclick="testVideo(1, 'play')">‚ñ∂ Reproducir</button>
                    <button class="btn" onclick="checkVideoSrc(1)">üîó Ver Src</button>
                </div>
                <div class="status loading" id="status1">Esperando test...</div>
            </div>
        </div>
        
        <!-- TEST 2: Ruta con ./ -->
        <div class="diagnostic-section">
            <h2 class="test-title">üìÇ Test 2: Ruta con ./</h2>
            <div class="video-test">
                <div class="path-info">
                    <strong>Ruta:</strong> ./assets/videos/Caja/arqueo-caja/arqueo-caja.mp4
                </div>
                <div class="video-container">
                    <video id="video2" controls playsinline webkit-playsinline muted preload="metadata">
                        <source src="./assets/videos/Caja/arqueo-caja/arqueo-caja.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="controls">
                    <button class="btn" onclick="testVideo(2, 'load')">üîÑ Cargar</button>
                    <button class="btn" onclick="testVideo(2, 'play')">‚ñ∂ Reproducir</button>
                    <button class="btn" onclick="checkVideoSrc(2)">üîó Ver Src</button>
                </div>
                <div class="status loading" id="status2">Esperando test...</div>
            </div>
        </div>
        
        <!-- TEST 3: Ruta Absoluta -->
        <div class="diagnostic-section">
            <h2 class="test-title">üåê Test 3: Ruta Absoluta</h2>
            <div class="video-test">
                <div class="path-info">
                    <strong>Ruta:</strong> /assets/videos/Caja/arqueo-caja/arqueo-caja.mp4
                </div>
                <div class="video-container">
                    <video id="video3" controls playsinline webkit-playsinline muted preload="metadata">
                        <source src="/assets/videos/Caja/arqueo-caja/arqueo-caja.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="controls">
                    <button class="btn" onclick="testVideo(3, 'load')">üîÑ Cargar</button>
                    <button class="btn" onclick="testVideo(3, 'play')">‚ñ∂ Reproducir</button>
                    <button class="btn" onclick="checkVideoSrc(3)">üîó Ver Src</button>
                </div>
                <div class="status loading" id="status3">Esperando test...</div>
            </div>
        </div>
        
        <!-- TEST 4: URL Completa (si estuviera en servidor) -->
        <div class="diagnostic-section">
            <h2 class="test-title">üåç Test 4: URL Completa Simulada</h2>
            <div class="video-test">
                <div class="path-info">
                    <strong>Ruta:</strong> file:///C:/Users/PERSONAL/Desktop/Capacitacion-Sinnut/assets/videos/Caja/arqueo-caja/arqueo-caja.mp4
                </div>
                <div class="video-container">
                    <video id="video4" controls playsinline webkit-playsinline muted preload="metadata">
                        <source src="file:///C:/Users/PERSONAL/Desktop/Capacitacion-Sinnut/assets/videos/Caja/arqueo-caja/arqueo-caja.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="controls">
                    <button class="btn" onclick="testVideo(4, 'load')">üîÑ Cargar</button>
                    <button class="btn" onclick="testVideo(4, 'play')">‚ñ∂ Reproducir</button>
                    <button class="btn" onclick="checkVideoSrc(4)">üîó Ver Src</button>
                </div>
                <div class="status loading" id="status4">Esperando test...</div>
            </div>
        </div>
        
        <!-- TEST 5: Multiple Sources -->
        <div class="diagnostic-section">
            <h2 class="test-title">üîÑ Test 5: M√∫ltiples Sources (Fallback)</h2>
            <div class="video-test">
                <div class="path-info">
                    <strong>Sources:</strong><br>
                    1. ./assets/videos/Caja/arqueo-caja/arqueo-caja.mp4<br>
                    2. assets/videos/Caja/arqueo-caja/arqueo-caja.mp4<br>
                    3. /assets/videos/Caja/arqueo-caja/arqueo-caja.mp4
                </div>
                <div class="video-container">
                    <video id="video5" controls playsinline webkit-playsinline muted preload="metadata">
                        <source src="./assets/videos/Caja/arqueo-caja/arqueo-caja.mp4" type="video/mp4">
                        <source src="assets/videos/Caja/arqueo-caja/arqueo-caja.mp4" type="video/mp4">
                        <source src="/assets/videos/Caja/arqueo-caja/arqueo-caja.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="controls">
                    <button class="btn" onclick="testVideo(5, 'load')">üîÑ Cargar</button>
                    <button class="btn" onclick="testVideo(5, 'play')">‚ñ∂ Reproducir</button>
                    <button class="btn" onclick="checkVideoSrc(5)">üîó Ver Src Activo</button>
                </div>
                <div class="status loading" id="status5">Esperando test...</div>
            </div>
        </div>
        
        <!-- RESULTADOS -->
        <div class="results-panel">
            <h3>üìä Resultados del Diagn√≥stico</h3>
            <div class="controls" style="margin-bottom: 20px;">
                <button class="btn" onclick="testAllVideos()" style="background: #27ae60;">üß™ Probar Todos</button>
                <button class="btn" onclick="generateReport()" style="background: #f39c12;">üìã Generar Reporte</button>
                <button class="btn" onclick="clearResults()" style="background: #95a5a6;">üóëÔ∏è Limpiar</button>
            </div>
            <div id="results">
                <div class="result-item">Presiona "Probar Todos" para iniciar el diagn√≥stico...</div>
            </div>
        </div>
    </div>
    
    <script>
        // SISTEMA DE DIAGN√ìSTICO DE RUTAS
        const PathDiagnostic = {
            results: {},
            
            init() {
                this.detectDevice();
                this.setupEventListeners();
                console.log('üîç PathDiagnostic inicializado');
            },
            
            detectDevice() {
                const ua = navigator.userAgent;
                this.device = {
                    isIOS: /iPad|iPhone|iPod/.test(ua),
                    isSafari: /Safari/.test(ua) && !/Chrome/.test(ua),
                    userAgent: ua,
                    currentURL: window.location.href,
                    baseURL: window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'))
                };
                
                const info = document.getElementById('deviceInfo');
                info.innerHTML = `
                    <strong>Dispositivo:</strong> ${this.device.isIOS ? 'üçé iOS' : 'üíª Otro'} 
                    ${this.device.isSafari ? 'Safari' : 'Otro navegador'}<br>
                    <strong>URL Base:</strong> ${this.device.baseURL}
                `;
            },
            
            setupEventListeners() {
                for (let i = 1; i <= 5; i++) {
                    const video = document.getElementById(`video${i}`);
                    if (video) {
                        this.setupVideoEvents(video, i);
                    }
                }
            },
            
            setupVideoEvents(video, index) {
                const statusEl = document.getElementById(`status${index}`);
                
                video.addEventListener('loadstart', () => {
                    this.updateStatus(statusEl, 'üìπ Iniciando carga...', 'loading');
                    this.results[`video${index}`] = { status: 'loading', timestamp: Date.now() };
                });
                
                video.addEventListener('loadedmetadata', () => {
                    this.updateStatus(statusEl, '‚úÖ Metadatos cargados - √âXITO', 'success');
                    this.results[`video${index}`] = { 
                        status: 'success', 
                        message: 'Metadatos cargados',
                        src: video.currentSrc,
                        timestamp: Date.now()
                    };
                });
                
                video.addEventListener('canplay', () => {
                    this.updateStatus(statusEl, 'üé¨ Listo para reproducir - PERFECTO', 'success');
                    this.results[`video${index}`] = { 
                        status: 'ready', 
                        message: 'Listo para reproducir',
                        src: video.currentSrc,
                        duration: video.duration,
                        timestamp: Date.now()
                    };
                });
                
                video.addEventListener('error', (e) => {
                    let errorMsg = 'Error desconocido';
                    if (e.target.error) {
                        const codes = ['ABORTED', 'NETWORK', 'DECODE', 'SRC_NOT_SUPPORTED'];
                        errorMsg = codes[e.target.error.code - 1] || `C√≥digo ${e.target.error.code}`;
                    }
                    this.updateStatus(statusEl, `‚ùå ERROR: ${errorMsg}`, 'error');
                    this.results[`video${index}`] = { 
                        status: 'error', 
                        message: errorMsg,
                        errorCode: e.target.error?.code,
                        timestamp: Date.now()
                    };
                });
                
                // Source error
                const sources = video.querySelectorAll('source');
                sources.forEach((source, sourceIndex) => {
                    source.addEventListener('error', () => {
                        console.log(`‚ùå Source ${sourceIndex + 1} fall√≥ en video ${index}`);
                    });
                });
            },
            
            updateStatus(element, message, type) {
                element.className = `status ${type}`;
                element.textContent = message;
                console.log(`[Video] ${message}`);
            }
        };
        
        // FUNCIONES DE CONTROL
        function testVideo(videoNum, action) {
            const video = document.getElementById(`video${videoNum}`);
            const statusEl = document.getElementById(`status${videoNum}`);
            
            if (!video) return;
            
            switch(action) {
                case 'load':
                    PathDiagnostic.updateStatus(statusEl, 'üîÑ Recargando...', 'loading');
                    video.load();
                    break;
                case 'play':
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => {
                                PathDiagnostic.updateStatus(statusEl, '‚ñ∂Ô∏è Reproduciendo - √âXITO TOTAL', 'success');
                            })
                            .catch((error) => {
                                PathDiagnostic.updateStatus(statusEl, `‚ùå Play fall√≥: ${error.name}`, 'error');
                            });
                    }
                    break;
            }
        }
        
        function checkVideoSrc(videoNum) {
            const video = document.getElementById(`video${videoNum}`);
            const statusEl = document.getElementById(`status${videoNum}`);
            
            if (!video) return;
            
            const currentSrc = video.currentSrc || 'No src cargado';
            const networkState = ['EMPTY', 'IDLE', 'LOADING', 'NO_SOURCE'][video.networkState];
            const readyState = ['HAVE_NOTHING', 'HAVE_METADATA', 'HAVE_CURRENT_DATA', 'HAVE_FUTURE_DATA', 'HAVE_ENOUGH_DATA'][video.readyState];
            
            PathDiagnostic.updateStatus(statusEl, `üîó Src: ${currentSrc} | Net: ${networkState} | Ready: ${readyState}`, 'warning');
        }
        
        function testAllVideos() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="result-item">üß™ Iniciando diagn√≥stico de todas las rutas...</div>';
            
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    testVideo(i, 'load');
                    setTimeout(() => {
                        testVideo(i, 'play');
                    }, 1000);
                }, i * 2000);
            }
            
            setTimeout(() => {
                generateReport();
            }, 12000);
        }
        
        function generateReport() {
            const results = document.getElementById('results');
            let report = '<h4>üìã Reporte de Compatibilidad:</h4>';
            
            const paths = [
                'assets/videos/Caja/arqueo-caja/arqueo-caja.mp4',
                './assets/videos/Caja/arqueo-caja/arqueo-caja.mp4',
                '/assets/videos/Caja/arqueo-caja/arqueo-caja.mp4',
                'file:/// (URL completa)',
                'M√∫ltiples sources'
            ];
            
            for (let i = 1; i <= 5; i++) {
                const result = PathDiagnostic.results[`video${i}`];
                const status = result?.status || 'no-test';
                const emoji = status === 'ready' ? '‚úÖ' : status === 'success' ? 'üü°' : status === 'error' ? '‚ùå' : '‚è≥';
                
                report += `
                    <div class="result-item">
                        ${emoji} <strong>Test ${i}:</strong> ${paths[i-1]}<br>
                        <strong>Estado:</strong> ${result?.message || 'No probado'}<br>
                        ${result?.src ? `<strong>Src activo:</strong> ${result.src}<br>` : ''}
                        ${result?.duration ? `<strong>Duraci√≥n:</strong> ${Math.round(result.duration)}s` : ''}
                    </div>
                `;
            }
            
            // Recomendaci√≥n
            const successTests = Object.values(PathDiagnostic.results).filter(r => r.status === 'ready' || r.status === 'success');
            if (successTests.length > 0) {
                report += `
                    <div class="result-item" style="background: rgba(46, 204, 113, 0.2);">
                        üéØ <strong>RECOMENDACI√ìN:</strong> Usar la configuraci√≥n del test que funcion√≥ mejor.<br>
                        Tests exitosos: ${successTests.length}/5
                    </div>
                `;
            } else {
                report += `
                    <div class="result-item" style="background: rgba(231, 76, 60, 0.2);">
                        ‚ö†Ô∏è <strong>PROBLEMA:</strong> Ning√∫n test funcion√≥. Verificar que el archivo existe en la ruta correcta.
                    </div>
                `;
            }
            
            results.innerHTML = report;
        }
        
        function clearResults() {
            PathDiagnostic.results = {};
            for (let i = 1; i <= 5; i++) {
                const statusEl = document.getElementById(`status${i}`);
                PathDiagnostic.updateStatus(statusEl, 'Esperando test...', 'loading');
            }
            document.getElementById('results').innerHTML = '<div class="result-item">Resultados limpiados.</div>';
        }
        
        // INICIALIZAR
        document.addEventListener('DOMContentLoaded', () => {
            PathDiagnostic.init();
        });
    </script>
</body>
</html>
